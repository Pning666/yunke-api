<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.4//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunke.core.module.studio.mapper.FundingMapper">

  <sql id="baseSql">
    SELECT  f.id,
            f.verifier_id,
            f.certifier_id,
            f.name,
            f.type,
            f.apply_time,
            f.success_time,
            f.invoice,
            f.cost,
            f.card,
            f.proposer_id,
            f.state,
            f.task_uuid
    FROM t_funding f
    where 1=1
  </sql>

  <select id="pageFundingDetail" parameterType="Funding" resultType="Funding">
    <include refid="baseSql"/>
      <if test="funding.id != null and funding.id != 0">                         <!--申请id-->
          AND f.id like CONCAT('%',#{funding.id},'%')
      </if>
      <if test="funding.state != null and funding.state != 0">                   <!--申请状态-->
          AND f.state = #{funding.state}
      </if>
      <if test="funding.applyTime != null and funding.applyTime != ''">           <!--时间-->
          AND f.apply_time=#{funding.applyTime}
      </if>
      <if test="funding.proposerId != null and funding.proposerId != 0">          <!--申请人-->
          AND f.proposer_id like CONCAT('%',#{funding.proposerId},'%')
      </if>
      <if test="funding.verifierId != null and funding.verifierId != 0">          <!--审核人-->
          AND f.verifier_id like CONCAT('%',#{funding.verifierId},'%')
      </if>
      <if test="funding.name != null and funding.name != ''">                      <!--报销名称-->
          AND f.name  like '%${funding.name}%'
      </if>
  </select>

    <select id="pageFundingCount" parameterType="Funding" resultType="Funding">
        select count(*) from t_funding where 1=1
        <if test="funding.id != null and funding.id != 0">
            AND f.id like CONCAT('%',#{funding.id},'%')
        </if>
        <if test="funding.state != null and funding.state != 0">
            AND f.state = #{funding.state}
        </if>
        <if test="funding.applyTime != null and funding.applyTime != ''">
            AND f.apply_time=#{funding.applyTime}
        </if>
        <if test="funding.proposerId != null and funding.proposerId != 0">
            AND f.proposer_id like CONCAT('%',#{funding.proposerId},'%')
        </if>
        <if test="funding.verifierId != null and funding.verifierId != 0">
            AND f.verifier_id like CONCAT('%',#{funding.verifierId},'%')
        </if>
        <if test="funding.name != null and funding.name != ''">
            AND f.name  like '%${funding.name}%'
        </if>
    </select>

    <select id="selectFundingCountById" parameterType="int" resultType="int">
        select COUNT(*) from t_funding where 1=1
        <if test="funding.id != null and funding.id != ''">
            AND f.id =#{fundingId}
        </if>
    </select>

    <select id="selectFundingById" parameterType="int" resultType="Funding">
        <include refid="baseSql"/>
        <if test="fundingId != null and fundingId != 0">                         <!--申请id-->
            AND f.id=#{fundingId}
        </if>
    </select>

   <delete id="deleteByFundingid">
    delete from t_funding where state=4
       <if test="array != null and array.length > 0">
          <foreach collection="array" open=" and id in(" close=")" item="id" separator=",">
               #{id}
          </foreach>
       </if>
    </delete>

    <update id="updateFunding" parameterType="Funding">
       update t_funding set id=#{funding.id}
       <if test="funding.verifierId != null and funding.verifierId != ''">
            ,verifier_id=#{funding.verifierId}
       </if>
        <if test="funding.certifierId != null and funding.certifierId != ''">
            ,certifier_id=#{funding.certifierId}
        </if>
        <if test="funding.name != null and funding.name != ''">
            ,name=#{funding.name}
        </if>
        <if test="funding.type != null and funding.type != ''">
            ,type=#{funding.type}
        </if>
        <if test="funding.applyTime != null and funding.applyTime != ''">
            ,apply_time=#{funding.applyTime}
        </if>
        <if test="funding.successTime != null and funding.successTime != ''">
            ,success_time=#{funding.successTime}
        </if>
        <if test="funding.invoice != null and funding.invoice != ''">
            ,invoice=#{funding.invoice}
        </if>
        <if test="funding.cost != null and funding.cost != ''">
            , cost=#{funding.cost}
        </if>
        <if test="funding.card != null and funding.card != ''">
            , card=#{funding.card}
        </if>
        <if test="funding.proposerId != null and funding.proposerId != ''">
            , proposer_id=#{funding.proposerId}
        </if>
        <if test="funding.state != null and funding.state != ''">
            , state=#{funding.state}
        </if>
        <if test="funding.taskUuid != null and funding.taskUuid != ''">
            , task_uuid=#{funding.taskUuid}
        </if>
        where id=#{funding.id}
    </update>
</mapper>